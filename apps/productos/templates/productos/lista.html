{% extends 'base.html' %}
{% load static %}

{% block title %}Productos{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-success fw-bold">Productos</h2>
        <a href="{% url 'productos:publicar' %}" class="btn btn-success">
            Publicar Producto
        </a>
    </div>

    <div class="row" id="productos-container">
        {% include 'productos/_lista.html' %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    let page = 1;
    let loading = false;

    function loadMore() {
        if (loading) return;
        loading = true;
        page++;

        fetch(`?page=${page}`, {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.html) {
                document.getElementById('productos-container').insertAdjacentHTML('beforeend', data.html);
            }
            loading = false;
        });
    }

    window.addEventListener('scroll', function () {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
            loadMore();
        }
    });
});
</script>
{% endblock %}